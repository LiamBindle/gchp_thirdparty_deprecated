module     g_fv_fill_mod
!******************************************************************
!******************************************************************
!** This routine was generated by Automatic differentiation.     **
!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.9.33  **
!******************************************************************
!******************************************************************
!==============================================
! referencing used modules
!==============================================
use fv_fill_mod

!==============================================
! all entries are defined explicitly
!==============================================
implicit none

contains
subroutine g_fillz( im, km, nq, q, g_q, dp, g_dp )
!******************************************************************
!******************************************************************
!** This routine was generated by Automatic differentiation.     **
!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.9.33  **
!******************************************************************
!******************************************************************
!==============================================
! all entries are defined explicitly
!==============================================
implicit none

!==============================================
! declare arguments
!==============================================
integer, intent(in) :: im
integer, intent(in) :: km
real, intent(in) :: dp(im,km)
real, intent(in) :: g_dp(im,km)
integer, intent(in) :: nq
real, intent(inout) :: g_q(im,km,nq)
real, intent(inout) :: q(im,km,nq)

!==============================================
! declare local variables
!==============================================
real :: dup
real :: g_dup
real :: g_help_h
real :: g_help_i
real :: g_help_j
real :: g_qly
real :: g_qup
real :: help_h
real :: help_i
real :: help_j
integer :: i
integer :: ic
integer :: k
real :: qly
real :: qup

!----------------------------------------------
! TANGENT LINEAR AND FUNCTION STATEMENTS
!----------------------------------------------
do ic = 1, nq
  do i = 1, im
    if (q(i,1,ic) .lt. 0.) then
      g_q(i,2,ic) = (-(g_dp(i,2)*(q(i,1,ic)*dp(i,1)/(dp(i,2)*dp(i,2)))))+g_dp(i,1)*(q(i,1,ic)/dp(i,2))+g_q(i,2,ic)+g_q(i,1,ic)*&
&(dp(i,1)/dp(i,2))
      q(i,2,ic) = q(i,2,ic)+q(i,1,ic)*dp(i,1)/dp(i,2)
      g_q(i,1,ic) = 0.
      q(i,1,ic) = 0.
    endif
  end do
  do k = 2, km-1
    do i = 1, im
      if (q(i,k,ic) .lt. 0.) then
        g_help_h = g_dp(i,k-1)*q(i,k-1,ic)+g_q(i,k-1,ic)*dp(i,k-1)
        help_h = q(i,k-1,ic)*dp(i,k-1)
        if (0. .lt. help_h) then
          g_qup = g_help_h
          qup = help_h
        else
          g_qup = 0.
          qup = 0.
        endif
        g_qly = -(g_dp(i,k)*q(i,k,ic)+g_q(i,k,ic)*dp(i,k))
        qly = -(q(i,k,ic)*dp(i,k))
        g_help_i = 0.5*g_qly
        help_i = 0.5*qly
        g_help_j = 0.99*g_qup
        help_j = 0.99*qup
        if (help_i .gt. help_j) then
          g_dup = g_help_j
          dup = help_j
        else
          g_dup = g_help_i
          dup = help_i
        endif
        g_q(i,k-1,ic) = g_dp(i,k-1)*(dup/(dp(i,k-1)*dp(i,k-1)))-g_dup/dp(i,k-1)+g_q(i,k-1,ic)
        q(i,k-1,ic) = q(i,k-1,ic)-dup/dp(i,k-1)
        g_q(i,k+1,ic) = g_dp(i,k+1)*((qly-dup)/(dp(i,k+1)*dp(i,k+1)))+g_dup/dp(i,k+1)+g_q(i,k+1,ic)-g_qly/dp(i,k+1)
        q(i,k+1,ic) = q(i,k+1,ic)-(qly-dup)/dp(i,k+1)
        g_q(i,k,ic) = 0.
        q(i,k,ic) = 0.
      endif
    end do
  end do
  k = km
  do i = 1, im
    if (q(i,k,ic) .lt. 0. .and. q(i,k-1,ic) .gt. 0.) then
      g_qup = g_dp(i,k-1)*q(i,k-1,ic)+g_q(i,k-1,ic)*dp(i,k-1)
      qup = q(i,k-1,ic)*dp(i,k-1)
      g_qly = -(g_dp(i,k)*q(i,k,ic)+g_q(i,k,ic)*dp(i,k))
      qly = -(q(i,k,ic)*dp(i,k))
      if (qly .gt. qup) then
        g_dup = g_qup
        dup = qup
      else
        g_dup = g_qly
        dup = qly
      endif
      g_q(i,k-1,ic) = g_dp(i,k-1)*(dup/(dp(i,k-1)*dp(i,k-1)))-g_dup/dp(i,k-1)+g_q(i,k-1,ic)
      q(i,k-1,ic) = q(i,k-1,ic)-dup/dp(i,k-1)
      g_q(i,k,ic) = (-(g_dp(i,k)*(dup/(dp(i,k)*dp(i,k)))))+g_dup/dp(i,k)+g_q(i,k,ic)
      q(i,k,ic) = q(i,k,ic)+dup/dp(i,k)
    else
      g_q(i,km,ic) = 0.
      q(i,km,ic) = 0.
    endif
  end do
end do

end subroutine g_fillz


end module     g_fv_fill_mod


